(ns r4f-data.measurements-test
  (:use midje.sweet
        midje.cascalog
        r4f-data.measurements))

(def m7-data [["\"64626338343139662d613765332d343632372d623339302d3665646130623437663038643a6170706172656e742d706f776572\": [],"]
              ["\"3130383936303a74656d7065726174757265\": [[\"2010-03-18T00:00:00+0000\",\"error:Measurement was not provided by meter\",1297773628134], [\"2010-03-18T00:05:00+0000\",\"error:Measurement was not provided by meter\",1297773628134], [\"2010-03-18T00:10:00+0000\",\"error:Measurement was not provided by meter\",1297773628134]],"]
              ["\"64343337613563392d376636372d346437642d393830362d3835393833306337666435363a656c656374726963697479436f6e73756d7074696f6e\": [[\"2012-02-01T00:00:00+0000\",\"{\\\"v\\\":203127}\",1330550899258000], [\"2012-02-01T00:05:00+0000\",\"{\\\"v\\\":203127}\",1330550899258001], [\"2012-02-01T00:10:00+0000\",\"{\\\"v\\\":203127}\",1330550899258002], [\"2012-02-01T00:15:00+0000\",\"{\\\"v\\\":203127}\",1330550899258003], [\"2012-02-01T00:20:00+0000\",\"{\\\"v\\\":203127}\",1330550899259000], [\"2012-02-01T00:25:00+0000\",\"{\\\"v\\\":203127}\",1330550899259001]],"]])

(fact (measurements m7-data (cascalog.api/stdout)) =>
      (produces [["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:00:00+0000" 203127]
                 ["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:05:00+0000" 203127]
                 ["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:10:00+0000" 203127]
                 ["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:15:00+0000" 203127]
                 ["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:20:00+0000" 203127]
                 ["d437a5c9-7f67-4d7d-9806-859830c7fd56:electricityConsumption" "2012-02-01T00:25:00+0000" 203127]]))